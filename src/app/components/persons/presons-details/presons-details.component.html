<div class="form-container ">
  <div class="form-header">
    <div class="form-toolbar">
      <div class="flex gap-4">
        <button
          type="button"
          class="cancel-btn"
          (click)="onCancel()">
          <mat-icon>arrow_back</mat-icon>
        </button>

        <button
          *ngIf="isFormEditable"
          type="button"
          class="cancel-btn"
          (click)="onCancel()"
          [disabled]="saving">
          <mat-icon>close</mat-icon>
          Abbrechen
        </button>
      </div>

      <h2 class="form-title">
        {{ !isEditMode ? "Neue Organisationseinheit anlegen" :
        "Organisationseinheit bearbeiten" }}
      </h2>
      <div>
        <button
          type="button"
          class="save-btn"
          (click)="onEditOrSubmit()"
          [disabled]="saving">
          <mat-icon>{{ isFormEditable ? 'check' : 'edit' }}</mat-icon>
          {{ isFormEditable ? 'Speichern' : 'Bearbeiten' }}
        </button>
      </div>
    </div>
  </div>

  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Daten werden geladen...</p>
  </div>

  <div class=" table-content scrollable-container">
    <mat-accordion>
      <form [formGroup]="form" class=" form-content ">

        <!-- Personendaten -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Personendaten</mat-panel-title>
          </mat-expansion-panel-header>

          <div formGroupName="personData"
            class="form-grid scrollable-container">

            <!-- Checkbox: Eingabe geprüft / Activ -->
            <div class="form-row mt-2 checkbox-row">
              <label class="field-label">Eingabe geprüft:</label>
              <mat-checkbox style="  margin-top: -10px;
" formControlName="inputVerified"></mat-checkbox>
            </div>

            <div class="form-row checkbox-row">
              <label class="field-label">Aktiv:</label>
              <mat-checkbox style="  margin-top: -10px;" formControlName="active"></mat-checkbox>
            </div>

            <!-- Titel -->
            <div class="form-row">
              <label class="field-label">Titel:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="title" />
              </mat-form-field>
            </div>

            <!-- Staatsangehörigkeit -->
            <div class="form-row">
              <label class="field-label">Staatsangehörigkeit:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="nationality" />
              </mat-form-field>
            </div>

            <!-- Familienname -->
            <div class="form-row">
              <label class="field-label">Familienname:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="familyName" />
              </mat-form-field>
            </div>

            <!-- Vorname -->
            <div class="form-row">
              <label class="field-label">Vorname:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="firstName" />
              </mat-form-field>
            </div>

            <!-- Geburtsdatum -->
            <div class="form-row">
              <label class="field-label">Geburtsdatum:</label>
              <mat-form-field appearance="outline"
                class="date-range-field label-input-group">
                <input matInput [matDatepicker]="birthPicker"
                  formControlName="birthDate" />
                <mat-datepicker-toggle matSuffix
                  [for]="birthPicker"></mat-datepicker-toggle>
                <mat-datepicker #birthPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <!-- Geschlecht -->
            <div class="form-row">
              <label class="field-label">Geschlecht:</label>
              <mat-form-field appearance="outline">
                <mat-select formControlName="gender">
                  <mat-option value="männlich">Männlich</mat-option>
                  <mat-option value="weiblich">Weiblich</mat-option>
                  <mat-option value="divers">Divers</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- Anmerkung -->
            <div class="form-row">
              <label class="field-label">Anmerkung:</label>
              <mat-form-field appearance="outline">
                <textarea matInput formControlName="note" rows="4"></textarea>
              </mat-form-field>
            </div>

          </div>

        </mat-expansion-panel>

        <!-- Organisationsdaten -->
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Organisationsdaten:</mat-panel-title>
          </mat-expansion-panel-header>

          <div formGroupName="organizationData"
            class="form-grid scrollable-container">
            <!-- Eintritts- / Austrittsdatum -->
            <div class="form-row date">
              <label class="field-label">Eintritts / Austrittsdatum:</label>
              <mat-form-field appearance="outline"
                class=" date-range-field  label-input-group">
                <input matInput [matDatepicker]="entryDatePicker"
                  formControlName="entryDate" value="25.11.2024" />
                <mat-datepicker-toggle matSuffix
                  [for]="entryDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #entryDatePicker></mat-datepicker>
              </mat-form-field>
              <span class="date-separator">/</span>
              <mat-form-field appearance="outline"
                class=" date-range-field  label-input-group">
                <input matInput [matDatepicker]="exitDatePicker"
                  formControlName="exitDate" value="31.12.9999" />
                <mat-datepicker-toggle matSuffix
                  [for]="exitDatePicker"></mat-datepicker-toggle>
                <mat-datepicker #exitDatePicker></mat-datepicker>
              </mat-form-field>

            </div>

            <div class="form-row">
              <label class="field-label">Organisationseinheit:</label>
              <mat-form-field appearance="outline">
                <mat-select
                  formControlName="organizationalUnit"
                  placeholder="Organisationseinheit wählen">
                  <mat-option value>< Organisationseinheit wählen
                    ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Mitarbeiterart:</label>
              <mat-form-field appearance="outline">
                <mat-select
                  formControlName="employeeType"
                  placeholder="Mitarbeiterart wählen">
                  <mat-option value>< Mitarbeiterart wählen ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Email geschäftlich:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  type="email"
                  formControlName="businessEmail"
                  placeholder="email@bmi.gv.at" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Email extern:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  type="email"
                  formControlName="externalEmail"
                  placeholder="email@example.com" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Dienstverwendung:</label>
              <mat-form-field appearance="outline">
                <mat-select
                  formControlName="employmentUse"
                  placeholder="Dienstverwendung wählen">
                  <mat-option value>< Dienstverwendung wählen ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Personenverantwortlichen:</label>
              <mat-form-field appearance="outline">
                <mat-select
                  formControlName="responsiblePerson"
                  placeholder="Personenverantwortlichen wählen">
                  <mat-option value>< Personenverantwortlichen wählen
                    ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Telefonnummer:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  type="tel"
                  formControlName="phoneNumber"
                  placeholder="+43 1 123456" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Mobilnummer BMI:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  type="tel"
                  formControlName="mobileNumberBMI"
                  placeholder="+43 664 123456" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Mobilnummer extern:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  type="tel"
                  formControlName="externalMobileNumber"
                  placeholder="+43 664 123456" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Teamzuordnung:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  formControlName="teamAssignment"
                  placeholder="Teamzuordnung" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Teamleiter:</label>
              <mat-form-field appearance="outline">
                <mat-select
                  formControlName="teamLeader"
                  placeholder="Teamleiter wählen">
                  <mat-option value>< Teamleiter wählen ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Zimmernummer:</label>
              <mat-form-field appearance="outline">
                <input
                  matInput
                  formControlName="roomNumber"
                  placeholder="Zimmernummer" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Freigebegruppe:</label>
              <mat-form-field appearance="outline">
                <mat-select
                  formControlName="releaseGroup"
                  placeholder="Freigebegruppe wählen">
                  <mat-option value>< Freigebegruppe wählen ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-row mt-2 checkbox-row">

              <label class="field-label ">Funktion:</label>
              <div class="flex" style="  margin-top: -10px;">
                <mat-checkbox
                  formControlName="isTeamLeader">Teamleiter</mat-checkbox>
                <mat-checkbox
                  formControlName="isDepartmentLeader">Abteilungsleiter</mat-checkbox>
              </div>
            </div>
          </div>
        </mat-expansion-panel>

        <!-- Betriebsdaten -->

        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Betriebsdaten</mat-panel-title>
          </mat-expansion-panel-header>

          <div formGroupName="operationalData"
            class="form-grid scrollable-container">
            <!-- الصف الأول -->
            <div class="form-row">
              <label class="field-label">Personalnr.:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="personalNumber"
                  placeholder="Personalnummer" />
              </mat-form-field>
            </div>
            <div class="form-row">
              <span class="field-label">Selbständig:</span>
              <mat-checkbox style="  margin-top: -10px;"
                formControlName="selfEmployed"
                class="margin-top: -5px;"></mat-checkbox>
            </div>

            <div class="form-row">
              <label class="field-label">Portal-User-ID:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="portalUserId"
                  placeholder="Portal-User-ID" />
              </mat-form-field>
            </div>

            <!-- الصف الثاني -->
            <div class="form-row">
              <label class="field-label">Beschäftigt bei:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="employedAt"
                  placeholder="Beschäftigt bei" />
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">BAKS-ID:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="baksId"
                  placeholder="BAKS-ID" />
              </mat-form-field>
            </div>

            <!-- الصف الثالث -->
            <div class="form-row">
              <label class="field-label">Geht-Rolle:</label>
              <mat-form-field appearance="outline">
                <mat-select formControlName="geltlRole"
                  placeholder="Geht-Rolle wählen">
                  <mat-option value>Default</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="form-row">
              <label class="field-label">Interessenskonflikte:</label>
              <mat-form-field appearance="outline"
                class="date-range-field  label-input-group">
                <input matInput [matDatepicker]="interessenPicker"
                  formControlName="conflictOfInterest"
                  placeholder="TT.MM.JJJJ" />
                <mat-datepicker-toggle matSuffix
                  [for]="interessenPicker"></mat-datepicker-toggle>
                <mat-datepicker #interessenPicker></mat-datepicker>
              </mat-form-field>
            </div>
            <div class="form-row">
              <label class="field-label">Bucher:</label>
              <mat-form-field appearance="outline">
                <mat-select formControlName="bucher"
                  placeholder="Bucher wählen">
                  <mat-option value>< Bucher wählen ></mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- الصف الرابع -->
            <div class="form-row">
              <label class="field-label">Strafregisterbescheinigung:</label>
              <mat-form-field appearance="outline"
                class="date-range-field  label-input-group">
                <input matInput [matDatepicker]="strafPicker"
                  formControlName="criminalRecord" placeholder="TT.MM.JJJJ" />
                <mat-datepicker-toggle matSuffix
                  [for]="strafPicker"></mat-datepicker-toggle>
                <mat-datepicker #strafPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form-row">
              <label class="field-label">Leistungskategorie:</label>
              <mat-form-field appearance="outline">
                <input matInput formControlName="performanceCategory"
                  placeholder="Leistungskategorie" />
              </mat-form-field>
            </div>

            <!-- الصف السادس -->

            <div class="left-column flex gap-3">
              <!-- الصف الأول -->
              <div class="form-row">
                <label class="field-label ">Stundenkontingent jährlich:</label>
                <mat-form-field appearance="outline">
                  <input matInput type="number" formControlName="annualHours"
                    placeholder="Stunden" />
                </mat-form-field>
              </div>

              <!-- الصف الثاني -->
              <div class="form-row">
                <label class="field-label">Stundenkontingent Vertrag:</label>
                <mat-form-field appearance="outline">
                  <input matInput type="number" formControlName="contractHours"
                    placeholder="Stunden" />
                </mat-form-field>
              </div>

              <!-- الصف الثالث -->
              <div class="form-row">
                <label class="field-label">Stundensatz inkl. UST.:</label>
                <mat-form-field appearance="outline">
                  <input matInput type="number" step="0.01"
                    formControlName="hourlyRate" placeholder="€" />
                </mat-form-field>
              </div>

              <!-- الصف الرابع -->
              <div class="form-row">
                <label class="field-label">Stundensatz Bereitschaft:</label>
                <mat-form-field appearance="outline">
                  <input matInput type="number" step="0.01"
                    formControlName="onCallRate" placeholder="€" />
                </mat-form-field>
              </div>
            </div>

            <!-- الصف الثامن -->
            <div class="form-row">
              <label class="field-label">Rechte:</label>
              <div class="flex align-content-start"
                style="gap: 8px; font-size: 12px; margin-top: -5px;">
                <mat-checkbox formControlName="canStamp">Stempen</mat-checkbox>
                <mat-checkbox formControlName="lanAccess">Freier LAN
                  Zugang</mat-checkbox>
                <mat-checkbox formControlName="remoteUser">Remote
                  User</mat-checkbox>
                <mat-checkbox
                  formControlName="onCall">Bereitschaft</mat-checkbox>
                <mat-checkbox formControlName="officeStamp">Online Stempeln
                  Büro</mat-checkbox>
                <mat-checkbox formControlName="homeOfficeStamp">Online Stempeln
                  Homeoffice</mat-checkbox>
                <mat-checkbox
                  formControlName="teleworker">Telearbeiter</mat-checkbox>
              </div>
            </div>
            <div class="form-row">
              <span class="field-label">Leer-PDF erzeugen:</span>
              <mat-checkbox formControlName="leerPdf"
                style="margin-top: -10px;"></mat-checkbox>
            </div>

          </div>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Vertragsdaten</mat-panel-title>
            <mat-checkbox (click)="$event.stopPropagation()" [checked]="true"
              style="margin-right: 10px;">
              inkl. inaktive
            </mat-checkbox>
          </mat-expansion-panel-header>

          <div class="contracts-container">
            <!-- Main Contract -->
            <div class="contract-header"
              (click)="toggleContractExpansion('contract1')">
              <mat-icon class="expand-icon">
                {{expandedContracts['contract1'] ? 'expand_more' :
                'chevron_right'}}
              </mat-icon>
              <span class="contract-title">BMI/IBM Leistungspartnerschaft
                2018</span>
              <div class="contract-values">
                <span>Geplant: 1.602,00</span>
                <span>Gebucht: 1.600,00</span>
              </div>
            </div>

            <!-- Nested Items (shown when expanded) -->
            <div class="nested-items" *ngIf="expandedContracts['contract1']">
              <!-- Sub Contract -->
              <div class="contract-header level-1"
                (click)="toggleContractExpansion('subContract1')">
                <mat-icon class="expand-icon">
                  {{expandedContracts['subContract1'] ? 'expand_more' :
                  'chevron_right'}}
                </mat-icon>
                <span class="contract-title">BMI/IBM Leistungspartnerschaft
                  2019</span>
                <div class="contract-values">
                  <span>Geplant: 1.938,00</span>
                  <span>Gebucht: 1.672,77</span>
                </div>
              </div>

              <!-- Nested under sub contract -->
              <div class="nested-items"
                *ngIf="expandedContracts['subContract1']">
                <!-- Level 1 Item -->
                <div class="contract-item level-1">
                  <span class="item-title">Betrieb Anwendungen 2020</span>
                  <div class="item-values">
                    <span>Volumen €: 1.350.000,00</span>
                    <span>Volumen Std.: 4.500</span>
                    <span>Geplant: 277</span>
                  </div>
                </div>

                <!-- Level 2 Item -->
                <div class="contract-item level-2">
                  <mat-icon class="person-icon">person</mat-icon>
                  <span class="item-title">Thiem Peter Franz</span>
                  <div class="item-values">
                    <span>Volumen €: 61.776,00</span>
                    <span>Gesamt: 400</span>
                    <span>Geplant: 252</span>
                  </div>
                </div>

                <!-- Another Level 1 Item -->
                <div class="contract-item level-1">
                  <span class="item-title">Betrieb Anwendungen 2023</span>
                  <div class="item-values">
                    <span>Volumen €: 3.503,90</span>
                    <span>Volumen Std.: 48</span>
                    <span>Geplant: 13</span>
                  </div>
                </div>
              </div>

              <!-- Other main level items -->
              <div class="contract-item level-0">
                <span class="item-title">BBO 2025</span>
                <div class="item-values">
                  <span>Volumen €: 100.000,00</span>
                  <span>Volumen Std.: 500</span>
                  <span>Geplant: 5</span>
                </div>
                <div class="person-reference">
                  <mat-icon>person</mat-icon>
                  <span>Thiem Peter Franz</span>
                </div>
              </div>

              <div class="contract-item level-0">
                <span class="item-title">Testauswertung 2019</span>
                <div class="item-values">
                  <span>Volumen €: 199,00</span>
                  <span>Volumen Std.: 2</span>
                </div>
                <div class="person-reference">
                  <mat-icon>person</mat-icon>
                  <span>Thiem Peter Franz</span>
                </div>
              </div>

              <div class="contract-item level-0">
                <span class="item-title">BeID Projekt 2019 / 2020</span>
                <div class="item-values">
                  <span>Geplant: 2,00</span>
                  <span>Gebucht: 2,00</span>
                </div>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
      </form>

    </mat-accordion>

  </div>
</div>